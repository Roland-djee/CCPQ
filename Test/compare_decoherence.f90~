program compare_decoherence
  use types
  use constants
  use write
  use read
  use crystal
  use interactions
  use deco
  implicit none
  integer :: k,l,m
  character(len=*), parameter :: fmt="(es20.10e3,es20.10e3,es20.10e3,&
       &es20.10e3,es20.10e3)"

  !======= GENERATING THE CRYSTAL =======

  ! Inputs for generating the crystal
  call read_inputs_generate

  write(*,*)'Read inputs for generating the crystal...'

  ! Generate the crystal site coordinates
  call generate_crystal
  ! Generate the impurities coordinate
  call generate_impurities

  write(*,*)'Crystal site and impurities generated...'

  ! Write crystal ouputs
  call crystal_ouputs
  ! Write impurities ouputs
  call impurities_ouputs

  write(*,*)'Outputs written...'

  !======= DECOHERENCE DYNAMICS ========

  ! Inputs for decoherence
  call decoherence_inputs

  write(*,*)'Read inputs for decoherence...'

  ! Generate couplings
  call couplings

  open(15,file='couplings.dat')

  m = 0
  do k=1,nb_imp - 1
     do l=k + 1,nb_imp
        m = m + 1
        write(15,fmt)C12(m),J(k),J(l),J(k),J(l)
     end do
  end do
  
  write(*,*)'Couplings computed...'
  
  ! Calculate decoherence
  call decohere

  write(*,*)'Decoherence computed and written...Enjoy !'

end program compare_decoherence

